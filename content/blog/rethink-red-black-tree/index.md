---
title: 重新认识红黑树
date: '2020-05-26T15:22:10+00:00'
description: 红黑树本质上是一种 2-3 平衡树。
---

几年前笔者刚开始找实习时，曾经面过四次阿里的一面，几乎每个面试官都会问这样一个问题，如何在一亿条数据中快速检索到某条数据？笔者当时并没有回答上来，反而觉得客户端没有处理这么多数据的场景。不过现在回想起来，一种可行的方案就是红黑树了。

我们都知道红黑树既是二叉搜索树又是平衡二叉树，最坏情况下的时间复杂度为 $2\log_{2}N$，所以当 $N=100000000$ 时至多需要大约 44 次检索即可。红黑树之所以如此高效，是因为 [其定义](https://zh.wikipedia.org/wiki/%E7%BA%A2%E9%BB%91%E6%A0%91) 保证了它在最坏情况下也基本是自平衡的：

> 1. 节点是红色或黑色
> 2. 根是黑色
> 3. 所有叶子都是黑色，注意叶子是 NIL 节点
> 4. 每个红色节点必须有两个黑色的子节点，即从每个叶子到根的所有路径上不能有两个连续的红色节点
> 5. 从任一节点到其每个叶子的所有 [简单路径](https://zh.wikipedia.org/wiki/%E9%81%93%E8%B7%AF_(%E5%9B%BE%E8%AE%BA)) 都包含相同数目的黑色节点

![维基百科的红黑树示意图](./wikipedia-red-black-tree.png)

> 这些约束确保了红黑树的关键特性：从根到叶子的最长的可能路径不多于最短的可能路径的两倍长。结果是这个树大致上是平衡的。
>
> 要知道为什么这些性质确保了这个结果，注意到性质 4 导致了路径不能有两个毗连的红色节点就足够了。最短的可能路径都是黑色节点，最长的可能路径有交替的红色和黑色节点。因为根据性质 5 所有最长的路径都有相同数目的黑色节点，这就表明了没有路径能多于任何其他路径的两倍长。

不过以上都是老生常谈了，相信大多数博客也都是这么介绍的。但都没有回答一个关键的问题，即红黑树究竟是怎样诞生的？我们一般都是通过观察结构特性来理解数据结构，但红黑树不一样的地方在于，它跳出了结构特性这种抽象的骨架，变得具体了——加上了颜色，使得理解难度瞬间上升。读者可能明白红黑树是怎样运行的，但却不一定知道它是怎样诞生的，这就有点知其然不知其所以然的嫌疑了。

笔者最近重新翻阅了《算法（第 4 版）》，发现书中介绍了一种名为「2-3 平衡树」的数据结构，这种数据结构符合我们对数据结构的一贯认知——没有任何颜色，并且与红黑树完美等价，非常容易理解。事实上该书的作者 [Sedgewick](https://www.cs.princeton.edu/~rs/) 也是 1978 年红黑树诞生的论文的两名作者之一（嗯，果然还是作者本人的阐述比较透彻 🤔

若读者身边有吃灰的《算法（第 4 版）》，请直接查阅「3.3 平衡查找树」章节，不用继续往下读了；若读者对 2-3 平衡树与红黑树之间的转换已经有所了解，则也不用往下读了——毕竟本文不过是书中内容的复述而已。那么接下来就让我们开始吧。

2-3 平衡树由两类节点组成：

- 2- 节点，该节点包含一个键和两个子节点，其左子节点的键小于它，而右子节点的键大于它
- 3- 节点，该节点包含两个键和三个子节点，其左子节点的键小于它，其中子结点的键位于该节点的两个键之间，而右子节点的键大于它

TODO
